<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>No AI — AI Slob Detector</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

  <style>
    :root{
      --bg1:#ff4fd8; --bg2:#00f0ff; --bg3:#fff36a;
      --ink:#141414; --paper:#fffdf7; --hot:#ff1b6b; --mint:#24ffb5;
      --line:3px solid rgba(0,0,0,.9);
      --r:18px;
      --shadow: 0 14px 0 rgba(0,0,0,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(255,255,255,.5), transparent 60%),
        radial-gradient(900px 500px at 90% 15%, rgba(255,255,255,.4), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      overflow-x:hidden;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px; display:grid; gap:16px;}
    header{display:flex; gap:14px; flex-wrap:wrap; align-items:flex-start; justify-content:space-between;}
    h1{margin:0; font-size:clamp(28px, 4vw, 44px); line-height:1.05;}
    .tag{
      display:inline-flex; align-items:center; gap:10px;
      background:rgba(255,255,255,.88); border:var(--line); border-radius:999px;
      padding:8px 12px; font-weight:900; text-transform:uppercase; letter-spacing:.3px;
      width: fit-content;
    }
    .dot{width:12px;height:12px;border-radius:50%; background:var(--hot); border:var(--line)}
    .sub{
      margin:10px 0 0 0; max-width:70ch;
      background:rgba(255,255,255,.86); border:var(--line); border-radius:14px;
      padding:10px 12px; line-height:1.4;
    }
    .card{
      background:rgba(255,255,255,.92);
      border:var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }

    /* Header pills: prevent wrapping from long filenames */
    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:nowrap;            /* IMPORTANT: never wrap */
      align-items:center;
      justify-content:space-between;
      min-height: 44px;            /* keeps height stable */
    }
    @media (max-width: 520px){
      .topbar{flex-wrap:wrap;}     /* on tiny screens, wrapping is fine */
    }

    .pill{
      display:flex; align-items:center; gap:8px;
      border:var(--line); border-radius:999px; padding:8px 10px;
      background:rgba(255,255,255,.9); font-weight:900; text-transform:uppercase; font-size:12px;
      min-width:0;                 /* allow ellipsis children to shrink */
    }
    .pill i{display:inline-block; width:10px; height:10px; border-radius:50%; background:#111; border:var(--line)}
    .value{
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;          /* ellipsis instead of wrapping */
      max-width: 260px;            /* cap so it can’t push layout */
    }
    @media (max-width: 520px){
      .value{max-width: 100%;}
    }

    .btns{margin-top:10px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;}
    button{
      border:var(--line); border-radius:999px; padding:10px 12px;
      font-weight:900; text-transform:uppercase; letter-spacing:.3px;
      cursor:pointer; background:var(--mint); box-shadow:0 10px 0 rgba(0,0,0,.2);
    }
    button:active{transform:translateY(2px)}
    button.danger{background:var(--hot); color:#fff}
    button[disabled]{opacity:.55; cursor:not-allowed; box-shadow:none}

    .grid{
      display:grid; gap:16px;
      grid-template-columns: 1.1fr .9fr;
      align-items:start;
    }
    @media (max-width: 880px){ .grid{grid-template-columns:1fr;} }

    /* Stable panels: no jump when results appear */
    .panel{
      height: min(74vh, 760px);
      min-height: 420px;
      display:flex;
      flex-direction:column;
    }

    .dropzone{
      flex:1; min-height:0;
      border:4px dashed rgba(0,0,0,.85);
      border-radius:var(--r);
      padding:14px;
      background:rgba(255,255,255,.7);
      display:flex; flex-direction:column; gap:10px;
      align-items:center; justify-content:center;
      text-align:center; cursor:pointer; user-select:none;
    }
    .dropzone.dragover{background:rgba(255,255,255,.9)}
    .drop-title{margin:0; font-weight:950; font-size:clamp(18px,2.2vw,24px);}
    .hint{margin:0; opacity:.85; font-size:14px; max-width:46ch;}

    .frame{
      width:min(420px, 92%);
      aspect-ratio:1/1;
      border:var(--line);
      border-radius:var(--r);
      background:var(--paper);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
    }
    .frame img{width:100%; height:100%; object-fit:cover; display:none;}
    .frame .ph{font-weight:900; opacity:.7; padding:16px;}

    .results{flex:1; min-height:0; display:flex; flex-direction:column; gap:10px;}
    .results h2{margin:0; font-size:18px;}
    .note{
      border:var(--line); border-radius:14px;
      background:rgba(255,255,255,.78);
      padding:10px 12px; font-size:12px; line-height:1.4;
    }
    .bars{
      flex:1; min-height:0;
      overflow:auto;
      display:flex; flex-direction:column; gap:10px;
      padding-right:6px;
    }
    .bar{
      border:var(--line); border-radius:14px;
      background:rgba(255,255,255,.78);
      padding:10px;
    }
    .bar-top{display:flex; justify-content:space-between; gap:10px; font-weight:900;}
    .meter{height:14px; border-radius:999px; background:rgba(0,0,0,.08); border:2px solid rgba(0,0,0,.35); overflow:hidden; margin-top:8px;}
    .fill{height:100%; width:0%; background:linear-gradient(90deg, var(--mint), var(--hot), var(--bg3)); transition:width .2s ease;}

    input[type="file"]{display:none}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:800;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>AI Slob Detector 0.1</h1>
        <p class="sub">Load the model, then click/drop one image. No webcam. Inference runs in your browser.</p>
      </div>

      <div class="card" style="min-width:min(460px,100%);">
        <div class="topbar">
          <span class="pill"><i></i> Model: <span class="value" id="model-status" title="">not loaded</span></span>
          <span class="pill"><i></i> Image: <span class="value" id="img-status" title="">none</span></span>
        </div>
        <div class="btns">
          <button id="loadBtn" type="button">Load model</button>
          <button id="clearBtn" type="button" class="danger" disabled>Clear</button>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card panel">
        <div class="dropzone" id="dropzone" role="button" tabindex="0" aria-label="Upload image">
          <p class="drop-title">Drop image here</p>
          <p class="hint">…or click this box to choose a file. (PNG/JPG/WebP)</p>

          <div class="frame">
            <img id="previewImg" alt="Uploaded preview" />
            <div class="ph" id="placeholder">Preview lands here.</div>
          </div>

          <input id="fileInput" type="file" accept="image/*" />
        </div>
      </section>

      <aside class="card panel">
        <div class="results">
          <h2>Predictions</h2>
          <div id="resultsNote" class="note">Load the model, then upload an image.</div>
          <div class="bars" id="bars"></div>
          <div class="note">
            Model base: <span class="mono" id="modelUrlText"></span>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // CONFIG (don’t name this URL; it shadows window.URL)
    const MODEL_BASE = "https://teachablemachine.withgoogle.com/models/YFtng1dTr/";
    const modelURL = MODEL_BASE + "model.json";
    const metadataURL = MODEL_BASE + "metadata.json";

    let model = null;

    // Elements
    document.getElementById("modelUrlText").textContent = MODEL_BASE;

    const loadBtn = document.getElementById("loadBtn");
    const clearBtn = document.getElementById("clearBtn");
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");

    const previewImg = document.getElementById("previewImg");
    const placeholder = document.getElementById("placeholder");

    const bars = document.getElementById("bars");
    const resultsNote = document.getElementById("resultsNote");

    const modelStatusEl = document.getElementById("model-status");
    const imgStatusEl = document.getElementById("img-status");

    function setModelStatus(text){
      modelStatusEl.textContent = text;
      modelStatusEl.title = text;
    }
    function setImgStatus(text){
      imgStatusEl.textContent = text;
      imgStatusEl.title = text; // full filename on hover
    }

    function nicePct(x){
      const pct = x * 100;
      if (pct >= 10) return pct.toFixed(1) + "%";
      if (pct >= 1) return pct.toFixed(2) + "%";
      return pct.toFixed(3) + "%";
    }

    function resetUI(){
      fileInput.value = "";
      previewImg.src = "";
      previewImg.style.display = "none";
      placeholder.style.display = "block";
      setImgStatus("none");
      clearBtn.disabled = true;
      bars.innerHTML = "";
      resultsNote.textContent = "Load the model, then upload an image.";
    }

    function renderBars(prediction){
      const sorted = [...prediction].sort((a,b)=> b.probability - a.probability);
      bars.innerHTML = "";

      for (const p of sorted){
        const bar = document.createElement("div");
        bar.className = "bar";

        const top = document.createElement("div");
        top.className = "bar-top";
        top.innerHTML = `<div>${p.className}</div><div>${nicePct(p.probability)}</div>`;

        const meter = document.createElement("div");
        meter.className = "meter";

        const fill = document.createElement("div");
        fill.className = "fill";
        fill.style.width = Math.max(0, Math.min(100, p.probability * 100)) + "%";

        meter.appendChild(fill);
        bar.appendChild(top);
        bar.appendChild(meter);
        bars.appendChild(bar);
      }

      const top1 = sorted[0];
      resultsNote.textContent = top1
        ? `Top guess: ${top1.className} (${nicePct(top1.probability)})`
        : "No predictions returned.";
    }

    async function loadModel(){
      loadBtn.disabled = true;
      setModelStatus("loading…");
      resultsNote.textContent = "Downloading model…";

      try{
        model = await tmImage.load(modelURL, metadataURL);
        setModelStatus(`loaded (${model.getTotalClasses()} classes)`);
        resultsNote.textContent = "Model loaded. Click/drop an image in the left box.";
        loadBtn.textContent = "Model loaded";
      } catch (e){
        console.error(e);
        setModelStatus("failed");
        resultsNote.textContent = "Model load failed. Check console + model URL.";
        loadBtn.disabled = false;
      }
    }

    async function predict(imgEl){
      if (!model){ resultsNote.textContent = "Load the model first."; return; }
      resultsNote.textContent = "Running inference…";
      try{
        const pred = await model.predict(imgEl);
        renderBars(pred);
      } catch (e){
        console.error(e);
        resultsNote.textContent = "Prediction failed. Try another image.";
      }
    }

    function handleFile(file){
      if (!file) return;
      if (!file.type?.startsWith("image/")) { resultsNote.textContent = "That file isn’t an image."; return; }
      if (!model) { resultsNote.textContent = "Load the model first, then upload."; return; }

      const objUrl = window.URL.createObjectURL(file);

      previewImg.onload = async () => {
        clearBtn.disabled = false;
        setImgStatus(file.name); // will ellipsis in UI, full name in tooltip
        await predict(previewImg);
        window.URL.revokeObjectURL(objUrl);
      };

      previewImg.src = objUrl;
      previewImg.style.display = "block";
      placeholder.style.display = "none";
    }

    // Events
    loadBtn.addEventListener("click", loadModel);
    clearBtn.addEventListener("click", resetUI);

    dropzone.addEventListener("click", () => {
      if (!model) { resultsNote.textContent = "Load the model first."; return; }
      fileInput.click();
    });

    dropzone.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        if (!model) { resultsNote.textContent = "Load the model first."; return; }
        fileInput.click();
      }
    });

    fileInput.addEventListener("change", (e) => handleFile(e.target.files?.[0]));

    ["dragenter","dragover"].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.add("dragover");
      });
    });
    ["dragleave","drop"].forEach(evt => {
      dropzone.addEventListener(evt, (e) => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.remove("dragover");
      });
    });
    dropzone.addEventListener("drop", (e) => handleFile(e.dataTransfer?.files?.[0]));

    // Init
    setModelStatus("not loaded");
    setImgStatus("none");
    resetUI();
  </script>
</body>
</html>
